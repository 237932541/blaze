
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Data &mdash; Blaze 0.6.0-dev documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.6.0-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-2.2.1.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-scrollspy.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-affix.js"></script>
    <link rel="top" title="Blaze 0.6.0-dev documentation" href="index.html" />
    <link rel="next" title="Expressions" href="expressions.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

<div class="container">
  <!-- This is copied from /web, find better solution -->
  <div class="masthead">
    <ul class="nav nav-pills pull-right">
        <li>
            <a href="index.html"><i class="icon-home"></i> Blaze</a>
        </li>

        <li>
            <a href="quickstart.html"><i class="icon-ok"></i> Examples</a>
        </li>

        <li>
            <a href="api.html"><i class="icon-download"></i> API</a>
        </li>

        <li>
            <a href="people.html"><i class="icon-user"></i> People</a>
        </li>

        <li>
            <a href="http://github.com/ContinuumIO/blaze"><i class="icon-download"></i> Source</a>
        </li>

        <li>
            <a href="http://groups.google.com/a/continuum.io/forum/#!forum/blaze-dev"><i class="icon-envelope"></i> Mailing List</a>
        </li>
    </ul>
    <h3 class="muted"><img src="_static/img/logo.png">Blaze</h3>
  </div>

  <hr>

  <div class="row">
      <div class="span3">
         <ul id="nav" class="nav nav-list" data-spy="affix" data-offset-top="200"><li><a href="index.html"><b>Index</b></a></li>
<ul>
<li><a class="reference internal" href="#">Data</a><ul>
<li><a class="reference internal" href="#interface">Interface</a><ul>
<li><a class="reference internal" href="#iteration">Iteration</a></li>
<li><a class="reference internal" href="#insertion">Insertion</a></li>
<li><a class="reference internal" href="#migration">Migration</a></li>
<li><a class="reference internal" href="#indexing">Indexing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#current-state">Current State</a><ul>
<li><a class="reference internal" href="#csv-json">CSV/JSON</a></li>
<li><a class="reference internal" href="#hdf5">HDF5</a></li>
<li><a class="reference internal" href="#directories">Directories</a></li>
<li><a class="reference internal" href="#sql">SQL</a></li>
<li><a class="reference internal" href="#specifying-datashape">Specifying Datashape</a></li>
<li><a class="reference internal" href="#interacting-with-open">Interacting with <tt class="docutils literal"><span class="pre">open</span></tt></a></li>
</ul>
</li>
</ul>
</li>
</ul>

         </ul>
      </div>
      <div class="span9">
          
  <div class="section" id="data">
<h1>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h1>
<p>Blaze Data Descriptors provide uniform access to a variety of common data
formats.  They provide standard iteration, insertion, and numpy-like fancy
indexing over on-disk files in common formats like csv, json, and hdf5 in
memory data strutures like core Python data structures and DyND arrays as well
as more sophisticated data stores like SQL databases.  The data descriptor
interface is analogous to the Python buffer interface described in PEP 3118,
but with some more flexibility.</p>
<p>Over the course of this document we&#8217;ll refer to the following simple
<tt class="docutils literal"><span class="pre">accounts.csv</span></tt> file:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">balance</span>
<span class="mi">1</span><span class="p">,</span> <span class="n">Alice</span><span class="p">,</span> <span class="mi">100</span>
<span class="mi">2</span><span class="p">,</span> <span class="n">Bob</span><span class="p">,</span> <span class="mi">200</span>
<span class="mi">3</span><span class="p">,</span> <span class="n">Charlie</span><span class="p">,</span> <span class="mi">300</span>
<span class="mi">4</span><span class="p">,</span> <span class="n">Denis</span><span class="p">,</span> <span class="mi">400</span>
<span class="mi">5</span><span class="p">,</span> <span class="n">Edith</span><span class="p">,</span> <span class="mi">500</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span> <span class="o">=</span> <span class="n">CSV</span><span class="p">(</span><span class="s">&#39;accounts.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="interface">
<h2>Interface<a class="headerlink" href="#interface" title="Permalink to this headline">¶</a></h2>
<div class="section" id="iteration">
<h3>Iteration<a class="headerlink" href="#iteration" title="Permalink to this headline">¶</a></h3>
<p>Data descriptors expose the <tt class="docutils literal"><span class="pre">__iter__</span></tt> method, which iterates over the
outermost dimension of the data.  This iterator yields vanilla Python objects
by default.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="p">)</span>
<span class="go">[(1L, u&#39;Alice&#39;, 100L),</span>
<span class="go"> (2L, u&#39;Bob&#39;, 200L),</span>
<span class="go"> (3L, u&#39;Charlie&#39;, 300L),</span>
<span class="go"> (4L, u&#39;Denis&#39;, 400L),</span>
<span class="go"> (5L, u&#39;Edith&#39;, 500L)]</span>
</pre></div>
</div>
<p>Data descriptors also expose a <tt class="docutils literal"><span class="pre">chunks</span></tt> method, which also iterates over the
outermost dimension but instead of yielding single rows of Python objects
instead yields larger chunks of compactly stored data.  These chunks emerge as
DyND arrays which are more efficient for bulk processing and data transfer.
DyND arrays support the <tt class="docutils literal"><span class="pre">__array__</span></tt> interface and so can be easily converted
to NumPy arrays.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">next</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">chunks</span><span class="p">())</span>
<span class="go">nd.array([[1, &quot;Alice&quot;, 100],</span>
<span class="go">          [2, &quot;Bob&quot;, 200],</span>
<span class="go">          [3, &quot;Charlie&quot;, 300],</span>
<span class="go">          [4, &quot;Denis&quot;, 400],</span>
<span class="go">          [5, &quot;Edith&quot;, 500]],</span>
<span class="go">         type=&quot;5 * {id : int64, name : string, balance : int64}&quot;)</span>
</pre></div>
</div>
</div>
<div class="section" id="insertion">
<h3>Insertion<a class="headerlink" href="#insertion" title="Permalink to this headline">¶</a></h3>
<p>Analagously to <tt class="docutils literal"><span class="pre">__iter__</span></tt> and <tt class="docutils literal"><span class="pre">chunks</span></tt> the methods <tt class="docutils literal"><span class="pre">extend</span></tt> and
<tt class="docutils literal"><span class="pre">extend_chunks</span></tt> allow for insertion of data into the data descriptor.  These
methods take iterators of Python objects and DyND arrays respectively.  The
data is coerced into whatever form is native for the storage medium e.g. text
for CSV or <tt class="docutils literal"><span class="pre">INSERT</span></tt> statements for SQL.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span> <span class="o">=</span> <span class="n">CSV</span><span class="p">(</span><span class="s">&#39;accounts.csv&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span><span class="o">.</span><span class="n">extend</span><span class="p">([(</span><span class="mi">6</span><span class="p">,</span> <span class="s">&#39;Frank&#39;</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span>
<span class="gp">... </span>            <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s">&#39;Georgina&#39;</span><span class="p">,</span> <span class="mi">700</span><span class="p">)])</span>
</pre></div>
</div>
</div>
<div class="section" id="migration">
<h3>Migration<a class="headerlink" href="#migration" title="Permalink to this headline">¶</a></h3>
<p>The combination of uniform iteration and insertion enables trivial data
migration between storage systems.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sql</span> <span class="o">=</span> <span class="n">SQL</span><span class="p">(</span><span class="s">&#39;postgres://user:password@hostname/&#39;</span><span class="p">,</span> <span class="s">&#39;accounts&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sql</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">csv</span><span class="p">))</span>  <span class="c"># Migrate csv file to Postgres database</span>
</pre></div>
</div>
</div>
<div class="section" id="indexing">
<h3>Indexing<a class="headerlink" href="#indexing" title="Permalink to this headline">¶</a></h3>
<p>Data descriptors also support fancy indexing.  As with iteration this supports
either Python objects or DyND arrays with the <tt class="docutils literal"><span class="pre">.py[...]</span></tt> and <tt class="docutils literal"><span class="pre">.dynd[...]</span></tt>
interfaces.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">csv</span><span class="o">.</span><span class="n">py</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;balance&#39;</span><span class="p">]])</span>
<span class="go">[(u&#39;Alice&#39;, 100L),</span>
<span class="go"> (u&#39;Charlie&#39;, 300L),</span>
<span class="go"> (u&#39;Edith&#39;, 500L),</span>
<span class="go"> (u&#39;Georgina&#39;, 700L),</span>
<span class="go"> (u&#39;Georgina&#39;, 700L)]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span><span class="o">.</span><span class="n">dynd</span><span class="p">[::</span><span class="mi">10</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;balance&#39;</span><span class="p">]]</span>
<span class="go">nd.array([[&quot;Alice&quot;, 100],</span>
<span class="go">          [&quot;Charlie&quot;, 300],</span>
<span class="go">          [&quot;Edith&quot;, 500],</span>
<span class="go">          [&quot;Georgina&quot;, 700]],</span>
<span class="go">         type=&quot;var * {name : string, balance : int64}&quot;)</span>
</pre></div>
</div>
<p>Performance of this approach varies depending on the underlying storage system.
For file-based storage systems like CSV and JSON we must seek through the file
to find the right line (see <a class="reference external" href="http://docs.continuum.io/iopro/index.html">iopro</a>), but don&#8217;t incur deserialization costs.
Some storage systems, like HDF5, support random access natively.</p>
</div>
</div>
<div class="section" id="current-state">
<h2>Current State<a class="headerlink" href="#current-state" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">blaze.data</span></tt> module robustly parses csv, json, hdf5 files and interacts
with SQL databases.</p>
<div class="section" id="csv-json">
<h3>CSV/JSON<a class="headerlink" href="#csv-json" title="Permalink to this headline">¶</a></h3>
<p>For text-based formats (csv, json) it depends on standard Python modules
like <tt class="docutils literal"><span class="pre">csv</span></tt> to tokenize strings and the fast library DyND to serialize and
deserialize data elements.  This separation enables a <em>serialize what you need</em>
approach ideal for subsampling datasets.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span> <span class="o">=</span> <span class="n">CSV</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span><span class="o">.</span><span class="n">py</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">]</span>  <span class="c"># Fast, deserializes a small fraction of dataset</span>
</pre></div>
</div>
</div>
<div class="section" id="hdf5">
<h3>HDF5<a class="headerlink" href="#hdf5" title="Permalink to this headline">¶</a></h3>
<p>HDF5 support comes via <a class="reference external" href="http://docs.h5py.org/en/latest/">h5py</a>, which loads data in through <tt class="docutils literal"><span class="pre">numpy</span></tt> arrays
and offers various forms of compression for binary data.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">hdf5</span> <span class="o">=</span> <span class="n">HDF5</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">datapath</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="directories">
<h3>Directories<a class="headerlink" href="#directories" title="Permalink to this headline">¶</a></h3>
<p>Directories of files are supported with meta descriptors <tt class="docutils literal"><span class="pre">Stack</span></tt> and
<tt class="docutils literal"><span class="pre">Concat</span></tt> which allow you to treat directories of files as a single, indexable
data source.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">filenames</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="s">&#39;*.csv&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">csvs</span> <span class="o">=</span> <span class="p">[</span><span class="n">CSV</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span> <span class="o">=</span> <span class="n">Stack</span><span class="p">(</span><span class="n">csvs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stack</span><span class="o">.</span><span class="n">py</span><span class="p">[:,</span> <span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">cat</span> <span class="o">=</span> <span class="n">Concat</span><span class="p">(</span><span class="n">csvs</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cat</span><span class="o">.</span><span class="n">py</span><span class="p">[::</span><span class="mi">2</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="sql">
<h3>SQL<a class="headerlink" href="#sql" title="Permalink to this headline">¶</a></h3>
<p>Robust SQL interaction is provided by <a class="reference external" href="http://www.sqlalchemy.org/">SQLAlchemy</a> which maps an abstract
expression system onto a variety of SQL backends including Postgres, MySQL,
SQLite, etc...</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">sql</span> <span class="o">=</span> <span class="n">SQL</span><span class="p">(</span><span class="s">&#39;postgresql://username:password@hostname/path&#39;</span><span class="p">,</span> <span class="s">&#39;table-name&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-datashape">
<h3>Specifying Datashape<a class="headerlink" href="#specifying-datashape" title="Permalink to this headline">¶</a></h3>
<p>Ideally Blaze is able to infer the schema/datashape of your dataset.  Systems
like SQL carry enough meta-data to ensure that this is possible.  Other systems
like CSV depend on heuristics.  These heurstics can fail or even err.  In that
case you may be prompted to provide more information</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span> <span class="o">=</span> <span class="n">CSV</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="go">TypeError: Could not determine schema</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># Full schema specification as a datashape string</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span> <span class="o">=</span> <span class="n">CSV</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="s">&#39;{id: int, name: string, amount: float32}&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># Just specify the column names, please discover types</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span> <span class="o">=</span> <span class="n">CSV</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;amount&#39;</span><span class="p">])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c"># Provide corrections where needed</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span> <span class="o">=</span> <span class="n">CSV</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;amount&#39;</span><span class="p">],</span>
<span class="gp">... </span>          <span class="n">typehints</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;amount&#39;</span><span class="p">:</span> <span class="s">&#39;float64&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="interacting-with-open">
<h3>Interacting with <tt class="docutils literal"><span class="pre">open</span></tt><a class="headerlink" href="#interacting-with-open" title="Permalink to this headline">¶</a></h3>
<p>Files that are compressed or hosted from the web (via <tt class="docutils literal"><span class="pre">urlopen</span></tt>) can still be
accessed by specifying a custom <tt class="docutils literal"><span class="pre">open</span></tt> function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">gzip</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">csv</span> <span class="o">=</span> <span class="n">CSV</span><span class="p">(</span><span class="s">&#39;accounts.csv.gz&#39;</span><span class="p">,</span> <span class="nb">open</span><span class="o">=</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


      </div>
  </div>
</div>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-27761864-10', 'auto');
    ga('send', 'pageview');
    </script>
  </body>
</html>