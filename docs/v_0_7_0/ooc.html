<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Out of Core Processing &mdash; Blaze 0.7.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.7.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-2.2.1.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-scrollspy.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-affix.js"></script>
    <link rel="top" title="Blaze 0.7.0 documentation" href="index.html" />
    <link rel="next" title="Server" href="server.html" />
    <link rel="prev" title="Interacting with SQL Databases" href="sql.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

<div class="container">
  <!-- This is copied from /web, find better solution -->
  <div class="masthead">
    <ul class="nav nav-pills pull-right">
        <li>
            <a href="index.html"><i class="icon-home"></i> Blaze</a>
        </li>

        <li>
            <a href="quickstart.html"><i class="icon-ok"></i> Examples</a>
        </li>

        <li>
            <a href="api.html"><i class="icon-download"></i> API</a>
        </li>

        <li>
            <a href="people.html"><i class="icon-user"></i> People</a>
        </li>

        <li>
            <a href="http://github.com/ContinuumIO/blaze"><i class="icon-download"></i> Source</a>
        </li>

        <li>
            <a href="http://groups.google.com/a/continuum.io/forum/#!forum/blaze-dev"><i class="icon-envelope"></i> Mailing List</a>
        </li>
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
    </ul>
    <h3 class="muted"><img src="_static/img/logo.png">Blaze</h3>
  </div>

  <hr>

  <div class="row">
      <div class="span3">
         <ul id="nav" class="nav nav-list" data-spy="affix" data-offset-top="200"><li><a href="index.html"><b>Index</b></a></li>
<ul>
<li><a class="reference internal" href="#">Out of Core Processing</a><ul>
<li><a class="reference internal" href="#how-do-i-use-this">How do I use this?</a></li>
<li><a class="reference internal" href="#how-does-it-work">How does it work?</a></li>
<li><a class="reference internal" href="#complex-example">Complex Example</a></li>
<li><a class="reference internal" href="#parallel-processing">Parallel Processing</a></li>
<li><a class="reference internal" href="#beyond-csvs">Beyond CSVs</a></li>
</ul>
</li>
</ul>

         </ul>
      </div>
      <div class="span9">
          
  <div class="section" id="out-of-core-processing">
<h1>Out of Core Processing<a class="headerlink" href="#out-of-core-processing" title="Permalink to this headline">¶</a></h1>
<p>Blaze includes nascent support for out-of-core processing with Pandas
DataFrames and NumPy NDArrays.  It combines a computationally-rich in-memory
solution (like pandas/numpy) with a computationally-poor out-of-core solution.</p>
<div class="section" id="how-do-i-use-this">
<h2>How do I use this?<a class="headerlink" href="#how-do-i-use-this" title="Permalink to this headline">¶</a></h2>
<p>Naive use of Blaze triggers out-of-core systems automatically when called on
large files.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">&#39;my-small-file.csv&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">my_column</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>  <span class="c"># Uses Pandas  </span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">&#39;my-large-file.csv&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">my_column</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>  <span class="c"># Uses Chunked Pandas  </span>
</pre></div>
</div>
</div>
<div class="section" id="how-does-it-work">
<h2>How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h2>
<p>Blaze breaks up the data resource into a sequence of chunks.  It pulls one
chunk into memory, operates on it, pulls in the next, etc..  After all chunks
are processed it often has to finalize the computation with another operation
on the intermediate results.</p>
<p>In the example above one might accomplish the computation above, counting the
number of non-null elements, with pure Pandas as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Operate on each chunk</span>
<span class="n">intermediate</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">&#39;my-large-file.csv&#39;</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000000</span><span class="p">):</span>
    <span class="n">intermediate</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="o">.</span><span class="n">my_column</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>

<span class="c"># Finish computation by operating on the intermediate result</span>
<span class="n">result</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">intermediate</span><span class="p">)</span>
</pre></div>
</div>
<p>This example accomplishes a single computation on the entire dataset, <tt class="docutils literal"><span class="pre">d.my_column.count()</span></tt>, by separating it into two stages</p>
<ol class="arabic simple">
<li>compute <tt class="docutils literal"><span class="pre">chunk.my_column.count()</span></tt> on each in-memory chunk</li>
<li>compute <tt class="docutils literal"><span class="pre">intermediate.sum()</span></tt> on the aggregated intermediate results</li>
</ol>
<p>Blaze figures out this process for you.  The code above only serves as an
example of the kind of thing that Blaze does automatically.  Blaze knows how to
separate a broad range of computations.  Notable exceptions include joins and
sorts.  Blaze does not currently support out-of-core computation on joins and
sorts.</p>
</div>
<div class="section" id="complex-example">
<h2>Complex Example<a class="headerlink" href="#complex-example" title="Permalink to this headline">¶</a></h2>
<p>To investigate further try out the <tt class="docutils literal"><span class="pre">split</span></tt> function in <tt class="docutils literal"><span class="pre">blaze.expr.split</span></tt>.
It will tell you exactly how Blaze intends to break up your computation.  Here
is a more complex example doing an out-of-core split-apply-combine operation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">blaze</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">blaze.expr.split</span> <span class="kn">import</span> <span class="n">split</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">bank</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">(</span><span class="s">&#39;bank&#39;</span><span class="p">,</span> <span class="s">&#39;var * {name: string, balance: int}&#39;</span><span class="p">)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">expr</span> <span class="o">=</span> <span class="n">by</span><span class="p">(</span><span class="n">bank</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">avg</span><span class="o">=</span><span class="n">bank</span><span class="o">.</span><span class="n">balance</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">split</span><span class="p">(</span><span class="n">bank</span><span class="p">,</span> <span class="n">expr</span><span class="p">)</span>  
<span class="go">((chunk,</span>
<span class="go">  by(chunk.name, avg_count=count(chunk.balance),</span>
<span class="go">                 avg_total=sum(chunk.balance))),</span>
<span class="go">(aggregate,</span>
<span class="go">  by(aggregate.name, avg=(sum(aggregate.avg_total)) /</span>
<span class="go">                          sum(aggregate.avg_count))))</span>
</pre></div>
</div>
<p>As in the first example this chunked split-apply-combine operation translates
the intended results into two different computations, one to perform on each
in-memory chunk of the data and one to perform on the aggregated results.</p>
<p>Note that you do not need to use <tt class="docutils literal"><span class="pre">split</span></tt> yourself.  Blaze does this for you
automatically.</p>
</div>
<div class="section" id="parallel-processing">
<h2>Parallel Processing<a class="headerlink" href="#parallel-processing" title="Permalink to this headline">¶</a></h2>
<p>If a data source is easily separable into chunks in a parallel manner then
computation may be accelerated by a parallel map function provided by
the <tt class="docutils literal"><span class="pre">multiprocessing</span></tt> module (or any similar module).</p>
<p>For example a dataset comprised of many CSV files may be easily split up (one
csv file = one chunk.)  To supply a parallel map function one currently must
use the explicit <tt class="docutils literal"><span class="pre">compute</span></tt> function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">&#39;my-many-csv-files-*.csv&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">my_column</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>  <span class="c"># Single core by default  </span>
<span class="gp">...</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">multiprocessing</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c"># Four processes  </span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">compute</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">my_column</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="nb">map</span><span class="o">=</span><span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">)</span>  <span class="c"># Parallel over four cores  </span>
<span class="gp">...</span>
</pre></div>
</div>
<p>Note that one can only parallelize over datasets that can be easily split in a
non-serial fashion.  In particular one can not parallelize computation over
a single CSV file.  Collections of CSV files and binary storage systems like
HDF5 and BColz all support multiprocessing.</p>
</div>
<div class="section" id="beyond-csvs">
<h2>Beyond CSVs<a class="headerlink" href="#beyond-csvs" title="Permalink to this headline">¶</a></h2>
<p>While pervasive, CSV files may not be the best choice for speedy processing.
Binary storage formats like HDF5 and BColz provide more opportunities for
parallelism and are generally much faster for large datasets.</p>
</div>
</div>


      </div>
  </div>
</div>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-27761864-10', 'auto');
    ga('send', 'pageview');
    </script>
  </body>
</html>