
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tips for working with CSV files &mdash; Blaze 0.7.1 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.7.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-2.2.1.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-scrollspy.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-affix.js"></script>
    <link rel="top" title="Blaze 0.7.1 documentation" href="index.html" />
    <link rel="next" title="Interacting with SQL Databases" href="sql.html" />
    <link rel="prev" title="URI strings" href="uri.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

<div class="container">
  <!-- This is copied from /web, find better solution -->
  <div class="masthead">
    <ul class="nav nav-pills pull-right">
        <li>
            <a href="index.html"><i class="icon-home"></i> Blaze</a>
        </li>

        <li>
            <a href="quickstart.html"><i class="icon-ok"></i> Examples</a>
        </li>

        <li>
            <a href="api.html"><i class="icon-download"></i> API</a>
        </li>

        <li>
            <a href="people.html"><i class="icon-user"></i> People</a>
        </li>

        <li>
            <a href="http://github.com/ContinuumIO/blaze"><i class="icon-download"></i> Source</a>
        </li>

        <li>
            <a href="http://groups.google.com/a/continuum.io/forum/#!forum/blaze-dev"><i class="icon-envelope"></i> Mailing List</a>
        </li>
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
    </ul>
    <h3 class="muted"><img src="_static/img/logo.png">Blaze</h3>
  </div>

  <hr>

  <div class="row">
      <div class="span3">
         <ul id="nav" class="nav nav-list" data-spy="affix" data-offset-top="200"><li><a href="index.html"><b>Index</b></a></li>
<ul>
<li><a class="reference internal" href="#">Tips for working with CSV files</a><ul>
<li><a class="reference internal" href="#how-to">How to</a></li>
<li><a class="reference internal" href="#how-does-it-work">How does it work?</a></li>
<li><a class="reference internal" href="#what-to-do-when-things-go-wrong">What to do when things go wrong</a><ul>
<li><a class="reference internal" href="#correcting-csv-dialects">Correcting CSV Dialects</a></li>
<li><a class="reference internal" href="#correcting-column-types">Correcting Column Types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#migrate-to-binary-storage-formats">Migrate to Binary Storage Formats</a></li>
</ul>
</li>
</ul>

         </ul>
      </div>
      <div class="span9">
          
  <div class="section" id="tips-for-working-with-csv-files">
<h1>Tips for working with CSV files<a class="headerlink" href="#tips-for-working-with-csv-files" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-to">
<h2>How to<a class="headerlink" href="#how-to" title="Permalink to this headline">¶</a></h2>
<p>Typically one provides a csv filename to the <tt class="docutils literal"><span class="pre">Data</span></tt> constructor like so</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">&#39;myfile.csv&#39;</span><span class="p">)</span>  
</pre></div>
</div>
<p>GZip extensions or collections of csv files are handled in the same manner.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">&#39;myfile-2014-01-*.csv.gz&#39;</span><span class="p">)</span>  
</pre></div>
</div>
<p>In the case of collections of CSV files the files are sorted by filename and
then considered to be concatenated into a single table.</p>
</div>
<div class="section" id="how-does-it-work">
<h2>How does it work?<a class="headerlink" href="#how-does-it-work" title="Permalink to this headline">¶</a></h2>
<p>Blaze primarily relies on Pandas to parse CSV files into DataFrames.  In the
case of large CSV files it may parse them into several DataFrames and then use
techniques laid out in the <a class="reference external" href="../ooc.html">out-of-core</a> section.</p>
</div>
<div class="section" id="what-to-do-when-things-go-wrong">
<h2>What to do when things go wrong<a class="headerlink" href="#what-to-do-when-things-go-wrong" title="Permalink to this headline">¶</a></h2>
<p>The same thing that makes CSV files so popular with humans, simple
readability/writability, makes them challenging for computers to reason about
robustly.</p>
<p>Interacting with CSV files often breaks down in one of two ways</p>
<ol class="arabic simple">
<li>We incorrectly guess the dialect of the CSV file (e.g. wrong delimiter, presence or absense of a header, ...)</li>
<li>We incorrectly guess the type of a column with the CSV file (e.g. an integer column turns out to have floats in it)</li>
</ol>
<p>Because Blaze operates in a lazy way, giving you access to large CSV files
without reading the entire file into memory it is forced to do some guesswork.
By default it guesses the dialect and types on the first few hundred lines of
text.  When this guesswork fails the user must supply additional information.</p>
<div class="section" id="correcting-csv-dialects">
<h3>Correcting CSV Dialects<a class="headerlink" href="#correcting-csv-dialects" title="Permalink to this headline">¶</a></h3>
<p>In the first case of incorrect guessing of CSV dialect (e.g. delimiter) Blaze
respects and passes through all keyword arguments to <a class="reference external" href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.io.parsers.read_csv.html">pandas.read_csv</a>.</p>
</div>
<div class="section" id="correcting-column-types">
<h3>Correcting Column Types<a class="headerlink" href="#correcting-column-types" title="Permalink to this headline">¶</a></h3>
<p>In the second case of incorrect guessing of column types Blaze accepts a
<a class="reference external" href="../datashape.html">datashape</a> as an additional keyword argument.  Common practice is to create a
<tt class="docutils literal"><span class="pre">Data</span></tt> object around a csv file, ask for its datashape, tweak that datashape
and then recreate the data object.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">&#39;myfile.csv&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>  
<span class="go">Exception: Integer column has NA values</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">dshape</span>  <span class="c"># Perhaps that integer column should be a float  </span>
<span class="go">dshape(&quot;var * {name: string, amount: int64}&quot;)</span>

<span class="go"># &lt;Copy-Paste&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">dshape</span><span class="p">(</span><span class="s">&quot;var * {name: string, amount: float64}&quot;</span><span class="p">)</span>  <span class="c"># change int to float  </span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">&#39;myfile.csv&#39;</span><span class="p">,</span> <span class="n">dshape</span><span class="o">=</span><span class="n">ds</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<div class="section" id="migrate-to-binary-storage-formats">
<h2>Migrate to Binary Storage Formats<a class="headerlink" href="#migrate-to-binary-storage-formats" title="Permalink to this headline">¶</a></h2>
<p>If you plan to reuse the same CSV files many times it may make sense to convert
them to an efficient binary store like HDF5 (common) or BColz (less common but
faster).  These storage formats provide better performance on your data and
also avoid the ambiguity that surrounds CSV files.</p>
<p>One can migrate from CSV files to a binary storage format using the <tt class="docutils literal"><span class="pre">into</span></tt>
function.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">into</span><span class="p">(</span><span class="s">&#39;myfile.bcolz&#39;</span><span class="p">,</span> <span class="s">&#39;myfiles-*.csv&#39;</span><span class="p">)</span>  

<span class="go"># or</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">into</span><span class="p">(</span><span class="s">&#39;myfile.hdf5::/mydataset&#39;</span><span class="p">,</span> <span class="s">&#39;myfiles-*.csv&#39;</span><span class="p">)</span>  

<span class="go"># or</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">into</span><span class="p">(</span><span class="s">&#39;sqlite:///mydb.db::mytable&#39;</span><span class="p">,</span> <span class="s">&#39;myfiles-*.csv&#39;</span><span class="p">)</span>  
</pre></div>
</div>
<p>When migrating from a loosely formatted system like CSV to a more strict system
like HDF5 or BColz there are a few things to keep in mind</p>
<ol class="arabic simple">
<li>Neither supports variable length strings well</li>
<li>But each supports fixed-length strings well and supports compression to
cover up overly large/wasteful fixed-lengths</li>
<li>HDF5 does not support datetimes well but can easily encode datetimes as
strings</li>
<li>BColz is a column store, offering much better performance on tables with
many columns</li>
<li>HDF5 is a standard technology with excellent library support outside of
the Python ecosystem</li>
</ol>
<p>To ensure that you encode your dataset appropriately we recommend passing a
datashape explicitly.  As in our previous example this can often be done by
editing automatically generated datashapes</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Data</span><span class="p">(</span><span class="s">&#39;myfile.csv&#39;</span><span class="p">)</span>  
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">dshape</span>  
<span class="go">dshape(&quot;var * {name: string, amount: int64}&quot;)</span>

<span class="go"># &lt;Copy-Paste&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">dshape</span><span class="p">(</span><span class="s">&quot;var * {name: string[20, &#39;ascii&#39;], amount: float64}&quot;</span><span class="p">)</span>  

<span class="gp">&gt;&gt;&gt; </span><span class="n">into</span><span class="p">(</span><span class="s">&#39;myfile.bcolz&#39;</span><span class="p">,</span> <span class="s">&#39;myfiles-*.csv&#39;</span><span class="p">,</span> <span class="n">dshape</span><span class="o">=</span><span class="n">ds</span><span class="p">)</span>  
</pre></div>
</div>
<p>Providing a datashape removes data type ambiguity from the transfer.</p>
</div>
</div>


      </div>
  </div>
</div>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-27761864-10', 'auto');
    ga('send', 'pageview');
    </script>
  </body>
</html>