
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Expression Design &mdash; Blaze 0.7.2 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../css/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.7.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-2.2.1.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-scrollspy.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-affix.js"></script>
    <link rel="top" title="Blaze 0.7.2 documentation" href="index.html" />
    <link rel="next" title="Expressions" href="expressions.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

<div class="container">
  <!-- This is copied from /web, find better solution -->
  <div class="masthead">
    <ul class="nav nav-pills pull-right">
        <li>
            <a href="index.html"><i class="icon-home"></i> Blaze</a>
        </li>

        <li>
            <a href="quickstart.html"><i class="icon-ok"></i> Examples</a>
        </li>

        <li>
            <a href="api.html"><i class="icon-download"></i> API</a>
        </li>

        <li>
            <a href="people.html"><i class="icon-user"></i> People</a>
        </li>

        <li>
            <a href="http://github.com/ContinuumIO/blaze"><i class="icon-download"></i> Source</a>
        </li>

        <li>
            <a href="http://groups.google.com/a/continuum.io/forum/#!forum/blaze-dev"><i class="icon-envelope"></i> Mailing List</a>
        </li>
<form class="navbar-search pull-right" style="margin-bottom:-3px;" action="search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
    </ul>
    <h3 class="muted"><img src="_static/img/logo.png">Blaze</h3>
  </div>

  <hr>

  <div class="row">
      <div class="span3">
         <ul id="nav" class="nav nav-list" data-spy="affix" data-offset-top="200"><li><a href="index.html"><b>Index</b></a></li>
<ul>
<li><a class="reference internal" href="#">Expression Design</a><ul>
<li><a class="reference internal" href="#common-expression-attributes">Common Expression Attributes</a></li>
</ul>
</li>
</ul>

         </ul>
      </div>
      <div class="span9">
          
  <div class="section" id="expression-design">
<h1>Expression Design<a class="headerlink" href="#expression-design" title="Permalink to this headline">¶</a></h1>
<p>At its core Blaze expresses analytics queries symbolicly.  It represents these
queries as an abstract expression tree.  This tree dictates user interaction,
optimizations, and is eventually walked to translate into other computational
systems.  Deep knowledge of abstact expressions is not necessary to use Blaze;
it is essential to develop in it.</p>
<img alt="A simple Blaze expression tree" class="align-right" src="_images/xyz.png" />
<p>Consider the following example:</p>
<div class="highlight-Python"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">blaze</span> <span class="kn">import</span> <span class="n">symbol</span><span class="p">,</span> <span class="n">log</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;int64&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">y</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;float32&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">z</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">y</span>
</pre></div>
</div>
<p>We represent the mathematical expression <tt class="docutils literal"><span class="pre">log(x</span> <span class="pre">-</span> <span class="pre">1)**y</span></tt> as a tree where
every operator (e.g. <tt class="docutils literal"><span class="pre">log</span></tt>, <tt class="docutils literal"><span class="pre">pow</span></tt>) is a node whose children are its
arguments.  All Blaze expressions and indeed all expressions in any
programming language can be represnted this way.  Blaze encodes this tree as a
data structure where every node is an object with type corresponding to its
operation.  For example there exists the following classes</p>
<div class="highlight-Python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">pow</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="o">...</span>
<span class="k">class</span> <span class="nc">sub</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="o">...</span>
<span class="k">class</span> <span class="nc">log</span><span class="p">(</span><span class="n">Expr</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>And our expression, written explicitly as Blaze sees it, would look like the
following:</p>
<div class="highlight-Python"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">blaze.expr</span> <span class="kn">import</span> <span class="n">Pow</span><span class="p">,</span> <span class="n">Sub</span><span class="p">,</span> <span class="n">log</span><span class="p">,</span> <span class="n">symbol</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">z</span> <span class="o">=</span> <span class="n">Pow</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">Sub</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;int64&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)),</span>
<span class="o">...</span>         <span class="n">symbol</span><span class="p">(</span><span class="s">&#39;y&#39;</span><span class="p">,</span> <span class="s">&#39;float32&#39;</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">z</span>
<span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">**</span> <span class="n">y</span>
</pre></div>
</div>
<div class="section" id="common-expression-attributes">
<h2>Common Expression Attributes<a class="headerlink" href="#common-expression-attributes" title="Permalink to this headline">¶</a></h2>
<p>There are a few important attributes and methods to investigate a Blaze
expression.</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">__class__</span></tt>: The type of a node corresponds to its operation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">==</span> <span class="nb">pow</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">._args</span></tt>: All children of a node, including parameters.  Args may include both Blaze expressions and other variables like strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">z</span><span class="o">.</span><span class="n">_args</span> <span class="o">==</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">_args</span> <span class="o">==</span> <span class="p">(</span><span class="s">&#39;x&#39;</span><span class="p">,</span> <span class="s">&#39;int64&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">._inputs</span></tt>: All children of a node, excluding parameters.  All inputs are Blaze expressions.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">z</span><span class="o">.</span><span class="n">_inputs</span> <span class="o">==</span> <span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">_inputs</span> <span class="o">==</span> <span class="p">()</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">._leaves()</span></tt>:  The symbols at the bottom of the expression tree:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">z</span><span class="o">.</span><span class="n">_leaves</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">_leaves</span><span class="p">()</span> <span class="o">==</span> <span class="p">(</span><span class="n">x</span><span class="p">,)</span>
</pre></div>
</div>
</li>
</ul>
<p>By recursively traversing either <tt class="docutils literal"><span class="pre">._args</span></tt> or <tt class="docutils literal"><span class="pre">._inputs</span></tt> you may inspect or
transform either all information pertaining to the tree or just the
expressions.</p>
<p>To clear up confusion between <tt class="docutils literal"><span class="pre">._args</span></tt> from <tt class="docutils literal"><span class="pre">._inputs</span></tt> consider the
following tabular example with sort.  <tt class="docutils literal"><span class="pre">._inputs</span></tt> contains only other Blaze
expressions while <tt class="docutils literal"><span class="pre">._args</span></tt> also contains parameters like the string
<tt class="docutils literal"><span class="pre">'balance'</span></tt>.</p>
<div class="highlight-Python"><div class="highlight"><pre><span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">symbol</span><span class="p">(</span><span class="s">&#39;t&#39;</span><span class="p">,</span> <span class="s">&#39;var * {name: string, balance: int}&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">expr</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s">&#39;balance&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">expr</span><span class="o">.</span><span class="n">_args</span>
<span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">&#39;balance&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">expr</span><span class="o">.</span><span class="n">_inputs</span>
<span class="p">(</span><span class="n">t</span><span class="p">,)</span>
</pre></div>
</div>
<p>Some convenience functions for common traversals already exist:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">._subs</span></tt>: replace nodes in the tree according to replacement dictionary:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">z</span>
<span class="go">(log(x - 1)) ** y</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">z</span><span class="o">.</span><span class="n">_subs</span><span class="p">({</span><span class="s">&#39;x&#39;</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span> <span class="s">&#39;y&#39;</span><span class="p">:</span> <span class="s">&#39;b&#39;</span><span class="p">})</span>
<span class="go">(log(a - 1)) ** b</span>
</pre></div>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">._subterms</span></tt>, a traversal along <tt class="docutils literal"><span class="pre">._inputs</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">_traverse</span><span class="p">())</span>
</pre></div>
</div>
<p>[(log(x - 1)) ** y, log(x - 1), x - 1, x, y]</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">._traverse</span></tt>, a traversal along <tt class="docutils literal"><span class="pre">._args</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">_traverse</span><span class="p">())</span>
<span class="go">[(log(x - 1)) ** y,</span>
<span class="go"> log(x - 1),</span>
<span class="go"> x - 1,</span>
<span class="go"> x,</span>
<span class="go"> &#39;x&#39;,</span>
<span class="go"> dshape(&quot;int64&quot;),</span>
<span class="go"> None,</span>
<span class="go"> 1,</span>
<span class="go"> y,</span>
<span class="go"> &#39;y&#39;,</span>
<span class="go"> dshape(&quot;float32&quot;),</span>
<span class="go"> None]</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>


      </div>
  </div>
</div>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-27761864-10', 'auto');
    ga('send', 'pageview');
    </script>
  </body>
</html>