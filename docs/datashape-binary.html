
<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Datashape Binary Data Layout &mdash; Blaze 0.4.0 documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-2.2.1.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/bootstrap-responsive-2.2.1.min.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="_static/js/bootstrap-2.2.1.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-scrollspy.js"></script>
    <script type="text/javascript" src="_static/js/bootstrap-affix.js"></script>
    <link rel="top" title="Blaze 0.4.0 documentation" href="index.html" />
    <link rel="next" title="Data Descriptors" href="data_descriptor.html" />
    <link rel="prev" title="Datashape" href="datashape.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

<div class="container">
  <!-- This is copied from /web, find better solution -->
  <div class="masthead">
    <ul class="nav nav-pills pull-right">
        <li>
            <a href="/index.html"><i class="icon-home"></i> Blaze</a>
        </li>
        
        <li class="active">
            <a href="/docs/index.html"><i class="icon-book"></i> Documentation</a>
        </li>
        
        <li>
            <a href="/examples.html"><i class="icon-ok"></i> Examples</a>
        </li>
        
        <li>
            <a href="http://github.com/ContinuumIO/blaze-core"><i class="icon-download"></i> Source</a>
        </li>
        
        <li>
            <a href="/vision.html"><i class="icon-star"></i> Vision</a>
        </li>
        
        <li>
            <a href="/people.html"><i class="icon-user"></i> People</a>
        </li>
        
        <li>
            <a href="http://groups.google.com/a/continuum.io/forum/#!forum/blaze-dev"><i class="icon-envelope"></i> Mailing List</a>
        </li>
    </ul>
    <h3 class="muted"><img src="_static/img/logo.png">Blaze</h3>
  </div>

  <hr>

  <div class="row">
      <div class="span3">
         <ul id="nav" class="nav nav-list" data-spy="affix" data-offset-top="200"><li><a href="index.html"><b>Index</b></a></li>
<ul>
<li><a class="reference internal" href="#">Datashape Binary Data Layout</a><ul>
<li><a class="reference internal" href="#measures">Measures</a></li>
<li><a class="reference internal" href="#dimensions">Dimensions</a></li>
<li><a class="reference internal" href="#records">Records</a></li>
<li><a class="reference internal" href="#missing-data">Missing Data</a></li>
<li><a class="reference internal" href="#memory-management-note">Memory Management Note</a></li>
<li><a class="reference internal" href="#properties-of-datashape-objects">Properties of Datashape Objects</a></li>
</ul>
</li>
</ul>

         </ul>
      </div>
      <div class="span9">
          
  <div class="section" id="datashape-binary-data-layout">
<h1>Datashape Binary Data Layout<a class="headerlink" href="#datashape-binary-data-layout" title="Permalink to this headline">¶</a></h1>
<p>A binary layout specification is needed for
kernels and other code to be able to consume and
produce data of a particular datashape. This document
specifies a mapping of datashape to raw memory layout
which is the default used when no additional information
about the data is known.</p>
<p>This mapping from datashape to binary data layout is one
possible mapping, intended as a default that computational
kernels can rely on when no additional information about
this is provided. Another language, possibly an extension
of datashape, adding richer support for describing data in
many different formats, is planned. The plan is to use
libdynd as the basis for this.</p>
<div class="section" id="measures">
<h2>Measures<a class="headerlink" href="#measures" title="Permalink to this headline">¶</a></h2>
<p>All types are in native byte order.</p>
</div>
<div class="section" id="dimensions">
<h2>Dimensions<a class="headerlink" href="#dimensions" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Datashape</th>
<th class="head">Binary Data Layout</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&lt;N&gt;, &lt;suffix&gt;</td>
<td>(where N is an integer.) N instances of the binary
layout for the datashape &lt;suffix&gt;, one after
the other.</td>
</tr>
<tr class="row-odd"><td>&lt;N&gt;, &lt;suffix&gt;</td>
<td>(where N is a symbolic TypeVar.) This datashape
does not have a binary layout</td>
</tr>
<tr class="row-even"><td>var, &lt;suffix&gt;</td>
<td>One pointer to a separate buffer, followed by
a pointer-sized integer (intptr_t) containing
the number of elements. The target of the pointer
should contain this many instances of the
datashape &lt;suffix&gt;, one after the other.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="records">
<h2>Records<a class="headerlink" href="#records" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Datashape</th>
<th class="head">Binary Data Layout</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>{f0: &lt;ds0&gt;; ...}</td>
<td>A C struct of all the binary layouts of datashapes
&lt;ds0&gt;, etc., packed exactly as the C compiler
would.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="missing-data">
<h2>Missing Data<a class="headerlink" href="#missing-data" title="Permalink to this headline">¶</a></h2>
<p>The missing data types are exactly as measure for their
parameter, but one bitpattern has been sacrificed for NA.</p>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Datashape</th>
<th class="head">Binary Data Layout</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Option(bool)</td>
<td>NA is 0xff.</td>
</tr>
<tr class="row-odd"><td>Option(int&lt;N&gt;)</td>
<td>NA is -2^(N-1).</td>
</tr>
<tr class="row-even"><td>Option(float&lt;N&gt;)</td>
<td>NA is 0x7ea2 (float16), 0x7f8007a2 (float32),
0x7ff00000000007a2 (float64),
0x7fff00000000000000000000000007a2 (float128).</td>
</tr>
<tr class="row-odd"><td>Option(complex[float&lt;N&gt;])</td>
<td>The first (real) component of the complex number
is the float&lt;N&gt; NA.</td>
</tr>
<tr class="row-even"><td>Option(string)</td>
<td>NA is two NULL pointers.</td>
</tr>
<tr class="row-odd"><td>Option(bytes)</td>
<td>NA is two NULL pointers.</td>
</tr>
<tr class="row-even"><td>Option(categorical(&lt;X&gt;))</td>
<td>NA is (2^N - 1), where the binary layout of
categorical(&lt;X&gt;) is uint&lt;N&gt;.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="memory-management-note">
<h2>Memory Management Note<a class="headerlink" href="#memory-management-note" title="Permalink to this headline">¶</a></h2>
<p>Some of these data layouts, including &#8220;string&#8221;, &#8220;bytes&#8221;, &#8220;json&#8221;,
and &#8220;var&#8221;, specify pointers into separate data buffers. The
ownership of these buffers must be held by the data descriptor
exposing the data, in addition to ownership of the primary data.</p>
</div>
<div class="section" id="properties-of-datashape-objects">
<h2>Properties of Datashape Objects<a class="headerlink" href="#properties-of-datashape-objects" title="Permalink to this headline">¶</a></h2>
<p>To support working with data of these data layouts, the objects
in blaze which represent datashapes have several properties.</p>
<p>All datashapes which have a binary layout as defined here
must have properties <cite>c_itemsize</cite> and <cite>c_alignment</cite>, which
are the number of bytes one element of the measure requires,
and what alignment it must satisfy. This alignment is the
same alignment C uses when packing the element into a struct.</p>
<p>Records have a property <cite>c_offsets</cite>, which is
a tuple of offsets to the starts of all the fields.</p>
<p>Array datashapes have a property <cite>c_strides</cite>,
which is just like the NumPy array strides, a byte offset
for incrementing by one along each dimension.</p>
</div>
</div>


      </div>
  </div>
</div>
  </body>
</html>